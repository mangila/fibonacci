<!-- Watermark: Junie - 2026-01-22 -->
# üî¢ Fibonacci Java Spring

> Autogenerated by Junie  
> Created Date: 2026-01-22

A high-performance Spring Boot application that computes Fibonacci numbers and streams updates in real-time.
Built with **Java 25**, it leverages **Virtual Threads** (Project Loom) and modern communication protocols for a robust and efficient experience.

---

## üöÄ Key Features

- **Fibonacci Generation**: Automatically computes Fibonacci numbers and persists them to a PostgreSQL database.
- **Real-time Streaming**:
    - **WebSockets (STOMP)**: Two-way communication for querying results and receiving live updates.
    - **Server-Sent Events (SSE)**: Efficient one-way streaming of new results and on-demand queries.
- **Advanced Concurrency**: Uses **Project Loom** (Virtual Threads) for I/O-bound tasks and **Platform Threads** for CPU-intensive computations.
- **PostgreSQL Notifications**: Utilizes `LISTEN/NOTIFY` via `pg_notify` to trigger application events whenever a new Fibonacci number is inserted, ensuring near-instant updates.
- **Flexible Algorithms**: Choose between several computation methods via configuration.

---

## üõ† Tech Stack

- **Java 25** (with Virtual Threads enabled)
- **Spring Boot 4.0.1**
- **Spring Web** & **Spring WebSocket**
- **Spring JDBC**
- **PostgreSQL**
- **Maven**
- **Testcontainers** (for integration testing)
- **Docker Compose** (for local development environments)

---

## üèÅ Getting Started

### Prerequisites

- **JDK 25**
- **Docker & Docker Compose**
- **Maven 3.9+**

### Running the Application

1. **Clone the repository**:
   ```bash
   git clone <repository-url>
   cd fibonacci/java-spring
   ```

2. **Start the application**:
   The application uses `spring-boot-docker-compose` to automatically spin up a PostgreSQL instance.
   ```bash
   ./mvnw spring-boot:run
   ```

The application will be accessible at `http://localhost:8080`.

---

## üìñ API Documentation

### Server-Sent Events (SSE)

| Endpoint | Method | Description |
|:---------|:------:|:------------|
| `/api/v1/sse/{channel}?streamKey={key}` | `GET` | Subscribe to a specific channel (e.g., `fibonacci`). |
| `/api/v1/sse/livestream/{channel}?streamKey={key}` | `GET` | Subscribe to the live computation stream. |
| `/api/v1/sse/{channel}/id?streamKey={key}&id={id}` | `GET` | Query a specific result by ID to the subscribed SSE stream. |
| `/api/v1/sse/{channel}/list?streamKey={key}` | `POST` | Query a list of results to the subscribed SSE stream. (Body: `FibonacciOption`) |

### WebSockets (STOMP)

- **Endpoint**: `/ws`
- **Topic (Livestream)**: `/topic/livestream`
- **User Queue (Results)**: `/user/queue/fibonacci`
- **User Queue (Single Result)**: `/user/queue/fibonacci/id`
- **User Queue (Errors)**: `/user/queue/errors`
- **Message Mappings**:
    - `fibonacci`: Send `FibonacciOption` to receive a list of results.
    - `fibonacci/id`: Send an `int` ID to receive a specific result.

---

## ‚öôÔ∏è Configuration

Configuration is managed via `src/main/resources/application.yaml`.

| Property | Default | Description |
|:---------|:--------|:------------|
| `app.fibonacci.algorithm` | `iterative` | Algorithm to use: `iterative`, `recursive`, `fast_doubling` |
| `app.fibonacci.offset` | `1` | Start Fibonacci index to compute |
| `app.fibonacci.limit` | `1000` | Maximum Fibonacci index to compute |
| `app.fibonacci.delay` | `1s` | Delay between computation tasks |
| `app.livestream.enabled` | `true` | Enable real-time computation livestream |
| `app.livestream.pg-channel` | `livestream` | PostgreSQL NOTIFY channel name |
| `app.sse.heartbeat.enabled` | `true` | Enable SSE heartbeat to keep connections alive |
| `app.sse.heartbeat.interval` | `10s` | Interval between SSE heartbeats |
| `app.sse.cleanup-period` | `10m` | Period for cleaning up stale SSE sessions |
| `server.port` | `8080` | Port the application runs on |
| `server.http2.enabled` | `true` | Enable HTTP/2 support |

---

## üóÑ Database Schema

The application uses a PostgreSQL table `fibonacci_results` and a trigger function `notify_new_fibonacci_result_fn` to notify the application of new inserts via the `livestream` channel.