# üìÖ Scheduler Module
  
> [!NOTE]
> This README was autogenerated by Junie on 2026-01-24.
  
The `scheduler` module provides background processing capabilities using **JobRunr**. It is responsible for executing long-running Fibonacci calculations asynchronously, ensuring the web module remains responsive.
  
## üõ† Responsibilities
  
- **Asynchronous Execution**: Offloads heavy `BigInteger` computations to background workers.
- **Persistence Layer**: Implements the repository pattern to store calculation results in PostgreSQL.
- **Job Lifecycle**: Manages retries, monitoring, and state transitions of computation tasks.
- **JobRunr Dashboard**: Provides a built-in UI for monitoring and managing background jobs.
- **Auto-Enqueuing**: Automatically schedules missing Fibonacci sequences on application startup.
  
## üèó Key Components
  
### `Scheduler`
The main entry point for background scheduling. It provides the `scheduleFibonacciCalculation` method which enqueues an initial job to process the request.
  
### `JobService`
A service annotated with JobRunr's `@Job`. It manages the high-level job flow:
- `enqueue(FibonacciCommand)`: Filters which sequences need to be calculated and enqueues individual computation jobs.
- `computeFibonacci(algorithm, sequence, delay)`: Executes the actual calculation and saves the result after a specified delay.
  
### `TaskService`
A coordination service that abstracts the execution of specific tasks using different executors:
- `submitComputeTask`: Executes `FibonacciComputeTask` on a dedicated `ThreadPoolTaskExecutor`.
- `submitSequenceFilter`: Executes `FibonacciSequenceFilterTask` on a `SimpleAsyncTaskExecutor`.
  
### `FibonacciComputeTask`
A `Callable` that performs the actual mathematical calculation by calling the `core` module.
  
### `FibonacciSequenceFilterTask`
A `Callable` that queries the database to determine which numbers in a requested range are not yet persisted.
  
### `FibonacciRepository`
The data access object responsible for saving and retrieving Fibonacci results. It uses `NamedParameterJdbcTemplate` for efficient PostgreSQL interactions.
  
## ‚öôÔ∏è How it Works
  
1. **Request**: A request comes in via the `web` module.
2. **Scheduling**: The `Scheduler` enqueues an `enqueue` job in JobRunr.
3. **Filtering**: The `enqueue` job uses `TaskService` (and `FibonacciSequenceFilterTask`) to find which numbers in the requested range are not yet in the database.
4. **Job Spawning**: For each missing number, a `computeFibonacci` job is enqueued.
5. **Computation**: The `computeFibonacci` job uses `TaskService` (and `FibonacciComputeTask`) to calculate the number using the `core` module.
6. **Persistence**: The result is saved to PostgreSQL.
7. **Notification**: PostgreSQL sends a `NOTIFY` signal, which is picked up by the `web` module to stream the result to clients.

## üìä Monitoring

The module includes the **JobRunr Dashboard**, which allows you to monitor job progress, view failed jobs, and manually trigger retries.

- **URL**: [http://localhost:8000](http://localhost:8000)
- **Features**: Real-time job statistics, worker health monitoring, and job history.
