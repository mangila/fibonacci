# üìÖ Scheduler Module
  
> [!NOTE]
> This README was autogenerated by Junie on 2026-01-24.
  
The `scheduler` module provides background processing capabilities using **JobRunr**. It is responsible for executing long-running Fibonacci calculations asynchronously, ensuring the web module remains responsive.
  
## üõ† Responsibilities
  
- **Asynchronous Execution**: Offloads heavy `BigInteger` computations to background workers.
- **Persistence Layer**: Implements the repository pattern to store calculation results in PostgreSQL.
- **Job Lifecycle**: Manages retries, monitoring, and state transitions of computation tasks.
- **JobRunr Dashboard**: Provides a built-in UI for monitoring and managing background jobs.
- **Auto-Enqueuing**: Automatically schedules missing Fibonacci sequences on application startup.
  
## üèó Key Components
  
### `Scheduler`
The main entry point for background scheduling. It uses an `ApplicationReadyEvent` listener to trigger the `FibonacciEnqueueTask` and subsequently enqueues computation jobs via JobRunr.
  
### `JobService`
A service annotated with JobRunr's `@Job`. It wraps the computation logic and handles the database persistence of results. It also implements a configurable delay and uses a `ReentrantLock` to ensure orderly saves.
  
### `FibonacciComputeTask`
A `Callable` implementation that wraps the `core` module's calculation logic. It is executed within a `ThreadPoolTaskExecutor` to perform the actual math.
  
### `FibonacciEnqueueTask`
Responsible for identifying which Fibonacci sequences are missing from the database. It compares a requested range (limit/offset) against existing records and returns a list of sequences that need to be computed.
  
### `FibonacciRepository`
The data access object responsible for saving and retrieving Fibonacci results. It uses `NamedParameterJdbcTemplate` for efficient PostgreSQL interactions, including `ON CONFLICT DO NOTHING` clauses to prevent duplicates.
  
## ‚öôÔ∏è How it Works
  
1. **Startup**: On `ApplicationReadyEvent`, the `Scheduler` triggers `FibonacciEnqueueTask`.
2. **Identification**: `FibonacciEnqueueTask` checks the database for missing sequences within the configured range.
3. **Enqueuing**: For each missing sequence, a job is enqueued in **JobRunr**.
4. **Execution**: **JobRunr** workers pick up the jobs and call `JobService.computeFibonacci()`.
5. **Computation**: The `FibonacciComputeTask` (using the `core` module) calculates the result.
6. **Persistence**: The result is saved back to PostgreSQL via `FibonacciRepository`.
7. **Downstream**: The saved results can then be picked up by the `web` module (via PostgreSQL `NOTIFY`) to be streamed to clients.

## üìä Monitoring

The module includes the **JobRunr Dashboard**, which allows you to monitor job progress, view failed jobs, and manually trigger retries.

- **URL**: `http://localhost:8000` (default)
- **Features**: Real-time job statistics, worker health monitoring, and job history.
