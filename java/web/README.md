# üåê Web Module

> [!NOTE]
> This README was autogenerated by Junie on 2026-01-24.

The `web` module is the communication gateway of the Fibonacci application. It provides multiple ways for clients to interact with the system, including RESTful APIs, Server-Sent Events (SSE), and WebSockets (STOMP).

## üõ† Responsibilities

- **REST API**: Provides endpoints for triggering new Fibonacci calculations.
- **Real-time Streaming**:
    - **SSE**: Unidirectional streaming of Fibonacci results.
    - **WebSockets**: Bi-directional communication using STOMP.
- **Database Synchronization**: Listens for PostgreSQL `NOTIFY` events to push new results to connected clients.
- **Validation**: Ensures all incoming requests meet the required constraints (e.g., valid Fibonacci algorithms, positive offsets).

## üèó Key Components

### `SchedulerController`
Handles the initial request to calculate a Fibonacci sequence. It delegates the scheduling to the `scheduler` module.

### `SseController`
Manages Server-Sent Events connections.
- **Livestream**: Subscribes to internal application events (triggered by DB notifications) and broadcasts them to all active SSE sessions.
- **On-demand Queries**: Allows clients to request specific sequences or lists via a persistent SSE channel.

### `WebSocketController`
Implements bi-directional communication using STOMP over WebSockets.
- **Topics**: Broadcasts the livestream to `/topic/livestream`.
- **User Queues**: Sends individual query results to user-specific queues (e.g., `/user/queue/fibonacci/list`).

### `FibonacciService`
The business logic layer that interacts with the `FibonacciRepository` to fetch calculated sequences and handle data projections.

### `PgNotificationListener`
A low-level component that maintains a dedicated connection to PostgreSQL and listens for `NOTIFY` signals. When a new Fibonacci result is saved by the scheduler, this listener triggers an internal `ApplicationEvent`.

## üì° Communication Protocols

| Protocol | Path | Description |
| :--- | :--- | :--- |
| **REST** | `/api/v1/scheduler` | POST to trigger new calculations. |
| **SSE** | `/api/v1/sse/{channel}` | Subscribe to a real-time event stream. |
| **WS** | `/ws` | STOMP endpoint for bi-directional messaging. |

## ‚öôÔ∏è How it Works

1.  **Notification**: When the `scheduler` module saves a result, PostgreSQL triggers a `NOTIFY` event.
2.  **Detection**: `PgNotificationListener` catches the signal and publishes a `PgNotificationPayloadCollection` event within the Spring ApplicationContext.
3.  **Broadcast**: Both `SseController` and `WebSocketController` listen for this event.
4.  **Push**:
    - `SseController` iterates through all active `SseEmitter` instances and sends the payload.
    - `WebSocketController` uses `SimpMessagingTemplate` to send the payload to the `/topic/livestream` topic.
